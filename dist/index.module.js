import{useState as r,useEffect as e,useReducer as t,useRef as n}from"react";var u=function(r,e,t,n){try{return Promise.resolve(e?n.encrypt(r,t):r)}catch(r){return Promise.reject(r)}},o=function(r,e,t,n){try{return Promise.resolve(e?n.decrypt(r,t):r)}catch(r){return Promise.reject(r)}},c=function(r,e){void 0===e&&(e=100);var t,n=[];return function(u){return n.push(u),t||(t=setTimeout(function(){var e=n.reduce(function(r,e){return r[e.id]=e.data,r},{});r(e),n=[],t=null},e)),function(){clearTimeout(t),n=[],t=null}}},i=function(r,e){var t,n=e.data;switch(e.type){case"add":return Object.assign({},r,n);case"update":return Object.assign({},r,((t={})[n.nodeID]=n,t));case"remove":return delete r[n],Object.assign({},r);default:throw new Error}},a=function(){var r=n(!1);return e(function(){return r.current=!0,function(){return r.current=!1}},[]),r},s=function(r,e){var n=t(r,e),u=n[0],o=n[1],c=a();return[u,function(r){c.current&&o(r)}]},f=function(e,t){return[r(e({peers:t}))[0]]},v=function(e){var t=r(null),n=t[0];return n||(0,t[1])(e.user()),[n]},d=function(t,n,u){void 0===u&&(u=!0);var o=v(t)[0],c=r(!1),i=c[0],a=c[1];return t.on("auth",function(){a(!0)}),e(function(){o&&!o.is&&n&&u&&o.auth(n)},[u,o,n]),[o,i]},l=function(e,t){var n=r(t),u=n[0],o=n[1];return u||function(){try{Promise.resolve(e.pair()).then(function(r){o(r)})}catch(r){return Promise.reject(r)}}(),[u,o]},m=function(t,f){var v=f.appKeys,d=f.sea,l=f.interval;void 0===l&&(l=100);var m=f.encrypted;void 0===m&&(m=!0);var h=r(t)[0],p=s(i,{}),y=p[0],P=p[1],j=n(null),g=a();return e(function(){var r=[];if(g.current){var e=c(function(r){P({type:"add",data:r})},l);h.on(function(t,n,u,c){try{return Promise.resolve(o(t,m,v,d)).then(function(t){Object.keys(t).forEach(function(n){var u=e({id:n,data:t[n]});r.push(u)}),j.current||(j.current=c)})}catch(r){return Promise.reject(r)}})}return function(){j.current&&j.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),[y,{put:function(r){try{return Promise.resolve(u(r,m,v,d)).then(function(r){return Promise.resolve(h.put(r)).then(function(){})})}catch(r){return Promise.reject(r)}},remove:function(r){try{return Promise.resolve(h.put(null)).then(function(){P({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}},h]};function h(t,f){var v=f.appKeys,d=f.sea,l=f.interval;void 0===l&&(l=100);var m=f.encrypted;void 0===m&&(m=!0);var h=r(t)[0],p=s(i,{}),y=p[0],P=p[1],j=n(null),g=a();return e(function(){var r=[];if(g.current){var e=c(function(r){P({type:"add",data:r})},l);h.map().on(function(t,n,u,c){try{return Promise.resolve(o(t,m,v,d)).then(function(t){if(t){var u=e({id:n,data:Object.assign({},t,{nodeID:n})});r.push(u)}j.current||(j.current=c)})}catch(r){return Promise.reject(r)}})}return function(){j.current&&j.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),[y,{addToSet:function(r){try{return Promise.resolve(u(r,m,v,d)).then(function(r){return Promise.resolve(h.set(r)).then(function(){})})}catch(r){return Promise.reject(r)}},updateInSet:function(r,e){try{return Promise.resolve(u(e,m,v,d)).then(function(t){return Promise.resolve(h.get(r).put(t)).then(function(){P({type:"update",data:Object.assign({},{nodeID:r},e)})})})}catch(r){return Promise.reject(r)}},removeFromSet:function(r){try{return Promise.resolve(h.get(r).put(null)).then(function(){P({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}},h]}export{u as encryptData,o as decryptData,f as useGun,v as useGunNamespace,d as useGunKeyAuth,l as useGunKeys,m as useGunState,h as useGunCollectionState};
//# sourceMappingURL=index.module.js.map
