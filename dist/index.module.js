import{useState as r,useEffect as e,useReducer as t,useRef as n}from"react";var u=function(r,e,t){try{return Promise.resolve(e&&t?t.encrypt(r,e):r)}catch(r){return Promise.reject(r)}},o=function(r,e,t){try{return Promise.resolve(e&&t?t.decrypt(r,e):r)}catch(r){return Promise.reject(r)}},c=function(r,e){void 0===e&&(e=100);var t,n=[];return function(u){return n.push(u),t||(t=setTimeout(function(){var e=n.reduce(function(r,e){return r[e.id]=e.data,r},{});r(e),n=[],t=null},e)),function(){clearTimeout(t),n=[],t=null}}},i=function(r,e){var t,n=e.data;switch(e.type){case"add":return Object.assign({},r,n);case"update":return Object.assign({},r,((t={})[n.nodeID]=n,t));case"remove":return delete r[n],Object.assign({},r);default:throw new Error}},a=function(){var r=n(!1);return e(function(){return r.current=!0,function(){return r.current=!1}},[]),r},s=function(r,e){var n=t(r,e),u=n[0],o=n[1],c=a();return[u,function(r){c.current&&o(r)}]},f=function(e,t){return[r(e({peers:t}))[0]]},v=function(e){var t=r(null),n=t[0];return n||(0,t[1])(e.user()),[n]},l=function(t,n,u){void 0===u&&(u=!0);var o=v(t)[0],c=r(!1),i=c[0],a=c[1];return t.on("auth",function(){a(!0)}),e(function(){o&&!o.is&&n&&u&&o.auth(n)},[u,o,n]),[o,i]},d=function(e,t){var n=r(t),u=n[0],o=n[1];return u||function(){try{Promise.resolve(e.pair()).then(function(r){o(r)})}catch(r){return Promise.reject(r)}}(),[u,o]},m=function(t,f){void 0===f&&(f={appKeys:"",sea:null,interval:100});var v=f.appKeys,l=f.sea,d=f.interval,m=r(t)[0],h=s(i,{}),p=h[0],y=h[1],P=n(null),j=a();return e(function(){var r=[];if(j.current){var e=c(function(r){y({type:"add",data:r})},d);m.on(function(t,n,u,c){try{return Promise.resolve(o(t,v,l)).then(function(t){Object.keys(t).forEach(function(n){var u=e({id:n,data:t[n]});r.push(u)}),P.current||(P.current=c)})}catch(r){return Promise.reject(r)}})}return function(){P.current&&P.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),[p,{put:function(r){try{return Promise.resolve(u(r,v,l)).then(function(r){return Promise.resolve(m.put(r)).then(function(){})})}catch(r){return Promise.reject(r)}},remove:function(r){try{return Promise.resolve(m.put(null)).then(function(){y({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}},m]},h=function(t,f){void 0===f&&(f={appKeys:"",sea:null,interval:100});var v=f.appKeys,l=f.sea,d=f.interval,m=r(t)[0],h=s(i,{}),p=h[0],y=h[1],P=n(null),j=a();return e(function(){var r=[];if(j.current){var e=c(function(r){y({type:"add",data:r})},d);m.map().on(function(t,n,u,c){try{return Promise.resolve(o(t,v,l)).then(function(t){if(t){var u=e({id:n,data:Object.assign({},t,{nodeID:n})});r.push(u)}P.current||(P.current=c)})}catch(r){return Promise.reject(r)}})}return function(){P.current&&P.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),[p,{addToSet:function(r){try{return Promise.resolve(u(r,v,l)).then(function(r){return Promise.resolve(m.set(r)).then(function(){})})}catch(r){return Promise.reject(r)}},updateInSet:function(r,e){try{return Promise.resolve(u(e,v,l)).then(function(t){return Promise.resolve(m.get(r).put(t)).then(function(){y({type:"update",data:Object.assign({},{nodeID:r},e)})})})}catch(r){return Promise.reject(r)}},removeFromSet:function(r){try{return Promise.resolve(m.get(r).put(null)).then(function(){y({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}},m]};export{u as encryptData,o as decryptData,f as useGun,v as useGunNamespace,l as useGunKeyAuth,d as useGunKeys,m as useGunState,h as useGunCollectionState};
//# sourceMappingURL=index.module.js.map
