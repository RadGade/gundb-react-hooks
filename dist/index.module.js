import{useState as r,useEffect as n,useReducer as e,useRef as t}from"react";var u=function(r,n,e){try{return Promise.resolve(n&&e?e.encrypt(r,n):r)}catch(r){return Promise.reject(r)}},o=function(r,n,e){try{return Promise.resolve(n&&e?e.decrypt(r,n):r)}catch(r){return Promise.reject(r)}},c=function(r,n){void 0===n&&(n=100);var e,t=[];return function(u){return t.push(u),e||(e=setTimeout(function(){var n=t.reduce(function(r,n){return r[n.id]=n.data,r},{});r(n),t=[],e=null},n)),function(){clearTimeout(e),t=[],e=null}}},i=function(r,n){var e,t=n.data;switch(n.type){case"add":return Object.assign({},r,t);case"update":return Object.assign({},r,((e={})[t.nodeID]=t,e));case"remove":return delete r[t],Object.assign({},r);default:throw new Error}},a=function(){var r=t(!1);return n(function(){return r.current=!0,function(){return r.current=!1}},[]),r},f=function(r,n){var t=e(r,n),u=t[0],o=t[1],c=a();return[u,function(r){c.current&&o(r)}]},s=function(n,e){return[r(n({peers:e}))[0]]},v=function(n){var e=r(null),t=e[0];return t||(0,e[1])(n.user()),[t]},l=function(e,t,u){void 0===u&&(u=!0);var o=v(e)[0],c=r(!1),i=c[0],a=c[1];return e.on("auth",function(){a(!0)}),n(function(){o&&!o.is&&t&&u&&o.auth(t)},[u,o,t]),[o,i]},m=function(n,e){var t=r(e),u=t[0],o=t[1];return u||function(){try{Promise.resolve(n.pair()).then(function(r){o(r)})}catch(r){return Promise.reject(r)}}(),[u,o]},d=function(e,s){void 0===s&&(s={appKeys:"",sea:null,interval:100});var v=s.appKeys,l=s.sea,m=s.interval;void 0===m&&(m=100);var d=r(e)[0],h=f(i,{}),p=h[0],P=h[1],y=t(null),j=a();return n(function(){var r=[];if(j.current){var n=c(function(r){P({type:"add",data:r})},m);d.on(function(e,t,u,c){try{return Promise.resolve(o(e,v,l)).then(function(e){Object.keys(e).forEach(function(t){var u=n({id:t,data:e[t]});r.push(u)}),y.current||(y.current=c)})}catch(r){return Promise.reject(r)}})}return function(){y.current&&y.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{fields:p,put:function(r){try{return Promise.resolve(u(r,v,l)).then(function(r){return Promise.resolve(new Promise(function(n,e){return d.put(r,function(r){return r.ok?n():e(r.err)})})).then(function(){})})}catch(r){return Promise.reject(r)}},remove:function(r){try{return Promise.resolve(new Promise(function(r,n){return d.put(null,function(e){return e.ok?r():n(e.err)})})).then(function(){P({type:"remove",data:r})})}catch(r){return Promise.reject(r)}}}},h=function(e,s){void 0===s&&(s={appKeys:"",sea:null,interval:100});var v=s.appKeys,l=s.sea,m=s.interval;void 0===m&&(m=100);var d=r(e)[0],h=f(i,{}),p=h[0],P=h[1],y=t(null),j=a();return n(function(){var r=[];if(j.current){var n=c(function(r){P({type:"add",data:r})},m);d.map().on(function(e,t,u,c){try{return Promise.resolve(o(e,v,l)).then(function(e){if(e){var u=n({id:t,data:Object.assign({},e,{nodeID:t})});r.push(u)}y.current||(y.current=c)})}catch(r){return Promise.reject(r)}})}return function(){y.current&&y.current.off(),r.length&&r.forEach(function(r){return r()})}},[]),{collection:p,addToSet:function(r,n){try{return Promise.resolve(u(r,v,l)).then(function(r){var e=n?Promise.resolve(new Promise(function(e,t){return d.get(n).put(r,function(r){return r.ok?e():t(r.err)})})).then(function(){}):Promise.resolve(new Promise(function(n,e){return d.set(r,function(r){return r.ok?n():e(r.err)})})).then(function(){});if(e&&e.then)return e.then(function(){})})}catch(r){return Promise.reject(r)}},updateInSet:function(r,n){try{return Promise.resolve(u(n,v,l)).then(function(e){return Promise.resolve(new Promise(function(n,t){return d.get(r).put(e,function(r){return r.ok?n():t(r.err)})})).then(function(){P({type:"update",data:Object.assign({},{nodeID:r},n)})})})}catch(r){return Promise.reject(r)}},removeFromSet:function(r){try{return Promise.resolve(new Promise(function(n,e){return d.get(r).put(null,function(r){return r.ok?n():e(r.err)})})).then(function(){})}catch(r){return Promise.reject(r)}}}};export{u as encryptData,o as decryptData,c as debouncedUpdates,i as reducer,a as useIsMounted,f as useSafeReducer,s as useGun,v as useGunNamespace,l as useGunKeyAuth,m as useGunKeys,d as useGunState,h as useGunCollectionState};
//# sourceMappingURL=index.module.js.map
